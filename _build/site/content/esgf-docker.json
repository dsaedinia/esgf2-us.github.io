{"version":2,"kind":"Article","sha256":"8792b528de39754e620429c98117c7672e12a9301e47a77e1b725358ce5a5438","slug":"esgf-docker","location":"/ESGF-Docker.md","dependencies":[],"frontmatter":{"title":"ESGF Docker Guide","github":"https://github.com/esgf2-us/esgf2-us.github.io","keywords":[],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/esgf2-us/esgf2-us.github.io/blob/new-Architecture/ESGF-Docker.md","exports":[{"format":"md","filename":"ESGF-Docker.md","url":"/ESGF-Docker-de1cbc89925ac0d0679cd4cd41e81867.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"esgf-docker","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"aoDsPvuQSr"}],"identifier":"esgf-docker","label":"esgf-docker","html_id":"esgf-docker","implicit":true,"key":"WHe4Csr0TU"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"This repository contains the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FKbVhAwzjW"},{"type":"inlineCode","value":"Dockerfile","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lKHPpdfmfY"},{"type":"text","value":"s and associated deployment artifacts for building\nand running the ESGF stack as Docker images.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WdBUggGtOt"}],"key":"gg9cXpWBwP"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Images are built automatically for every commit that modifies the ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"XzeXKkbmHz"},{"type":"inlineCode","value":"images","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lyTgO3DnQE"},{"type":"text","value":" directory and pushed\nto Docker Hub under the ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Toy5YArpmT"},{"type":"link","url":"https://hub.docker.com/u/esgfdeploy","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"esgfdeploy organisation","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"iWo7mjBQTa"}],"urlSource":"https://hub.docker.com/u/esgfdeploy","key":"cSt3B6bUA5"},{"type":"text","value":".","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"WlfuMCeIUf"}],"key":"Wef47Shkdx"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"The ESGF stack can be deployed in one of two ways:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tyX7UQeRI1"}],"key":"aqrG3ZI7ak"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Using Ansible to deploy and configure containers on specific hosts","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"gxoD4DRJ7R"}],"key":"DBAN2shziO"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Using Helm to deploy containers to a Kubernetes cluster","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"BNOALdT8zF"}],"key":"NDE65GByKx"}],"key":"k7jeEbDVb1"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"The Kubernetes deployment is recommended if possible, but we recognise that not all sites will\nbe comfortable configuring and maintaining a Kubernetes cluster. However Ansible-based deployments\nwill not benefit from many features provided by Kubernetes, including:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"bMouBQay0h"}],"key":"w7iOMlSfkE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":22,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Zero downtime upgrades","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"wAPYimEnHR"}],"key":"CsFNWwComf"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Health checks providing increased resilience","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"eOtrgR0vAs"}],"key":"j1xZokHi9x"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Automatic scaling and load-balancing","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"B4mLv5ZeCU"}],"key":"P3i6mrKMAG"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Aggregated logging and metrics","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"G3p2KX3OI6"}],"key":"Wnu5p1yhWR"}],"key":"xbSwy1C64W"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Current status","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"DWHny9L95O"}],"identifier":"current-status","label":"Current status","html_id":"current-status","implicit":true,"key":"NTgQ2eS4e6"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"This project is under heavy active development, with the implementation depending on the ESGF\nFuture Architecture discussions.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"yVe3brMiq4"}],"key":"wg1Ir7w7A5"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Currently, data and index nodes are implemented but ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"kTSSsr0Vdz"},{"type":"strong","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"without","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"THwcUVdmzB"}],"key":"jzAHLnTWAD"},{"type":"text","value":" authentication.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"ZLybFCk72V"}],"key":"Xy2fqBDauj"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"The data node uses THREDDS to serve catalog and OPeNDAP endpoints, but uses Nginx for direct file\nserving which should be more performant than THREDDS.","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"xwYmg03sVr"}],"key":"jw3uWAUhKn"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"The data node is capable of using existing catalogs from the current publisher to specify the\navailable data, however it is designed primarily to use a catalog-free configuration which utilises\n","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"YIFjqSa4zw"},{"type":"link","url":"https://www.unidata.ucar.edu/software/tds/current/reference/DatasetScan.html","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"datasetScan elements","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"e2laRZxLD3"}],"urlSource":"https://www.unidata.ucar.edu/software/tds/current/reference/DatasetScan.html","key":"HSFgDQGENs"},{"type":"text","value":",\nto serve all files under a given dataset root. This will work with the next-generation publisher\nbeing developed at LLNL that does not rely on THREDDS catalogs for publishing metadata.","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"sEm2VvbKaT"}],"key":"UwEsAGe0Ty"},{"type":"heading","depth":3,"position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Image tags","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"jH16Kzxy2R"}],"identifier":"image-tags","label":"Image tags","html_id":"image-tags","implicit":true,"key":"oLyItjCr67"},{"type":"paragraph","position":{"start":{"line":45,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"Each image that is built for ESGF Docker is given several tags. Some of these are immutable, which\nmeans they refer to a fixed version of the image for all time, and some are mutable which means\nthat the underlying image will change over time.","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"Rvo7Bm0Tmx"}],"key":"TP2Iz1BFNL"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"ESGF Docker will apply the following tags when building images:","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"tBmhnREZnv"}],"key":"uQHBiDjGBO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":51,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":51,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Mutable tags","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"BUHsmNNXVm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":52,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"inlineCode","value":"latest","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"fLMB5GLRFy"},{"type":"text","value":": the latest build for the ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"hnqLtzYPvK"},{"type":"inlineCode","value":"master","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"pSXwWVD0Mc"},{"type":"text","value":" branch","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"nduqOL9mnS"}],"key":"ccJ1yLjT5a"},{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"inlineCode","value":"<slugified-branch-name>","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"tXwrm4x5za"},{"type":"text","value":": the latest build for the given branch name, as a slug, e.g.\nfor the branch ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"dsO8pu6Mdd"},{"type":"inlineCode","value":"issue/112/nginx-data-node","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"VkEKKIQ2Ax"},{"type":"text","value":" use ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"go8dDuaHP4"},{"type":"inlineCode","value":"issue-112-nginx-data-node","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"V3pX9UwjBf"}],"key":"nniAm9eweV"}],"key":"bY30tgO6Ma"}],"key":"PMPRdWjVW0"},{"type":"listItem","spread":true,"position":{"start":{"line":55,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"Immutable tags","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"pJEOSG82xc"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":56,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"The short Git hash for the commit that triggered the build, e.g. ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"j0R5YhSfeC"},{"type":"inlineCode","value":"d65ca162","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"XMLximoYUm"},{"type":"text","value":", ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"BMS0RBXZO0"},{"type":"inlineCode","value":"a031a2ca","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"nVjk9gVM7F"}],"key":"zVHU53Vuvh"},{"type":"listItem","spread":true,"position":{"start":{"line":57,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"The tag name for any tagged releases","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"eayFV0fAO8"}],"key":"vTiuO3dJ7i"}],"key":"MCH3lk3z7X"}],"key":"nCpQIhJApW"}],"key":"jyhKrvDU74"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"By default, both the Ansible and Kubernetes installations use the ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"p6wHDmrXAo"},{"type":"inlineCode","value":"latest","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"qDcFKSkl3y"},{"type":"text","value":" tag when specifying\nDocker images, which is a mutable tag.","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"QVnoZqLVQI"}],"key":"FjhE7GDSVA"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"For production installations it is recommended to use an immutable tag, either for a tagged\nrelease or a particular commit, in order to avoid unexpected code changes or differences in\nthe container image between load-balanced nodes.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"Ch17rfpJFb"}],"key":"BI0H8BAWZS"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"You can check the ","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"m2V6yadB8S"},{"type":"link","url":"https://hub.docker.com/r/esgfdeploy/thredds/tags","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"available tags on Docker Hub","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"rNcncKToIq"}],"urlSource":"https://hub.docker.com/r/esgfdeploy/thredds/tags","key":"JlON6X2Nnh"},{"type":"text","value":".\nAll the ESGF Docker images are built together, so any given tag will be available for all images.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"IVipkUHbIb"}],"key":"KpzV5KJkp6"},{"type":"heading","depth":3,"position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"Making a deployment","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"Oo4MWBqJfU"}],"identifier":"making-a-deployment","label":"Making a deployment","html_id":"making-a-deployment","implicit":true,"key":"tHFPT8HsNB"},{"type":"paragraph","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"Whether deploying ESGF using Kubernetes or Ansible, the first step is to clone the repository:","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"xmagJjxDbh"}],"key":"inpkhJkZtg"},{"type":"code","lang":"sh","value":"git clone https://github.com/ESGF/esgf-docker.git\ncd esgf-docker","position":{"start":{"line":73,"column":1},"end":{"line":76,"column":1}},"key":"YGDxtMHgaV"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Then follow the deployment guide for your chosen deployment method:","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"h7ZguF955R"}],"key":"wAKIjbi86W"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":80,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"link","url":"./docs/deploy-ansible.md","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Deploy ESGF using Ansible","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"s0zg4AzUbV"}],"urlSource":"./docs/deploy-ansible.md","key":"CDDJjfnMhi"}],"key":"KxwBVIgm3D"},{"type":"listItem","spread":true,"position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"link","url":"./docs/kubernetes/deploy.md","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"Deploy ESGF to Kubernetes using Helm","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"P5sAi3WOhg"}],"urlSource":"./docs/kubernetes/deploy.md","key":"wz5NpAyxiK"}],"key":"Sjl78T9soK"}],"key":"iyu7UlAr4o"}],"key":"UA2e59BMf7"}],"key":"eplyFoav3j"},"references":{"cite":{"order":[],"data":{}}}}